package com.meepo.basic.authimport android.util.Logimport com.meepo.basic.schema.UserSummaryimport com.meepo.sdk.base.mvp.BasePresenterimport com.meepo.config.http.ResponseWrapperimport com.meepo.sdk.observer.Observerimport com.meepo.sdk.observer.ObserverManager.applySchedulers/** * @author  佟旭 * @wechat tongxury * @date  2020/10/14 10:46 PM * @version 1.0 */class Presenter : BasePresenter<IContract.IView>(), IContract.IPresenter {    override fun sendAuthCode(phoneNo: String) {        Service.get().sendCode(phoneNo)            .applySchedulers()            .map { rsp -> rsp.data }            .compose(mView?.bindToLife<Unit>())            .doFinally { mView?.doFinally() }            .subscribe(object : Observer<Unit>() {                override fun onSuccess(t: Unit?) {                    mView?.onCodeSent()                }                override fun onFailure(e: Throwable) {                }            })    }    override fun loginByCode(phoneNo: String, code: String) {        Service.get().loginByCode(phoneNo, code)            .applySchedulers()            .map { rsp -> rsp.data }            .compose(mView?.bindToLife<UserSummary>())            .doFinally { mView?.doFinally() }            .subscribe(object : Observer<UserSummary>() {                override fun onSuccess(t: UserSummary?) {                    t?.let {                        mView?.onLoginSuccess(it)                    }                }                override fun onFailure(e: Throwable) {                    Log.e("onFailure", e.message)                }            })    }    override fun loginByPassword(phoneNo: String, password: String) {        Service.get().loginByPassword(phoneNo, password)            .applySchedulers()            .compose(mView?.bindToLife<ResponseWrapper<UserSummary>>())            .doFinally { mView?.doFinally() }            .subscribe(object : Observer<ResponseWrapper<UserSummary>>() {                override fun onSuccess(t: ResponseWrapper<UserSummary>?) {                    t?.data?.let {                        mView?.onLoginSuccess(it)                        return                    }                    t?.message?.let {                        mView?.onLoginFail(it)                    }                }                override fun onFailure(e: Throwable) {                    Log.e("onFailure", e.message)                }            })    }    override fun loginByOneKey(accessToken: String) {        Service.get().loginByOneKey(accessToken)            .applySchedulers()            .map { rsp -> rsp.data }            .compose(mView?.bindToLife<UserSummary>())            .doFinally { mView?.doFinally() }            .subscribe(object : Observer<UserSummary>() {                override fun onSuccess(t: UserSummary?) {                    t?.let {                        mView?.onLoginSuccess(it)                    }                }                override fun onFailure(e: Throwable) {                    Log.e("onFailure", e.message)                }            })    }}